<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"/>
<meta content="width=device-width,user-scalable=no" name="viewport">
<script src="https://cdn.jsdelivr.net/npm/jquery/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<div id="content"></div>
<script>
  function getQueryVariable(variable)
  {
    var query = window.location.search.substring(1);
    var vars = query.split("&");
    for (var i=0;i<vars.length;i++) {
      var pair = vars[i].split("=");
      if(pair[0] == variable){return pair[1];}
    }
    return false;
  }
  function md(str)
  {
    document.getElementById('content').innerHTML = 
    document.getElementById('content').innerHTML+marked(str)+"\n\n";
  }
  function changeFrameHeight(that)
  {
    $(that).height(document.documentElement.clientHeight-120);
  }
  function loadXMLDoc(url)
  {
    var xmlhttp;
    var urlbool=false;
    if (window.XMLHttpRequest)
      xmlhttp=new XMLHttpRequest();
    else
      xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
    xmlhttp.onreadystatechange=function()
    {
      if(xmlhttp.readyState==4 && xmlhttp.status==200)
        urlbool=true;
    }
    xmlhttp.open("GET",url,false);
    xmlhttp.send();
    return urlbool;
  }
</script>
<script>
  var articleURL="https://mysterious-Palace.github.io/markdown/article/";
  if(getQueryVariable("name")==false||(getQueryVariable("id")==false&&getQueryVariable("directory")==false))
  {
    md("# 404");
    md("## 搜索数据不全！");
  }
  else
  {
    if(getQueryVariable("directory")=="true")
    {
      var urlhtml,urlmd;
      document.write("<title>"+decodeURI(getQueryVariable("name"))+"-目录</title>");
      md("# "+decodeURI(getQueryVariable("name"))+"-目录 | [返回搜索页](https://mysterious-Palace.github.io/markdown/)");
      var i=1;
      while(true)
      {
        urlmd=loadXMLDoc("../article/"+decodeURI(getQueryVariable("name"))+"/"+String(i)+".md");
        urlhtml=loadXMLDoc("../article/"+decodeURI(getQueryVariable("name"))+"/"+String(i)+".html");
        if(urlmd||urlhtml)
        {
          var mly="[第"+String(i)+"章]("+"?name="+getQueryVariable("name")+"&id="+String(i)+")";
          if(i%5==0)
            document.getElementById('content').innerHTML = 
            document.getElementById('content').innerHTML
              +marked(mly)+"\n\n";
          else
            document.getElementById('content').innerHTML = 
            document.getElementById('content').innerHTML
              +marked(mly+" | ");
        }
        else
          break;
        i++;
      }
      if(i==1)
        md("## 本文暂无章节")
    }
    else
    {
      document.write("<title>"+decodeURI(getQueryVariable("name"))+"-第"+getQueryVariable("id")+"章</title>");
      md(
        "# "+decodeURI(getQueryVariable("name"))+"-第"+getQueryVariable("id")+"章"
        +" | "
        +"[返回目录](?name="+getQueryVariable("name")
        +"&directory=true"
        +") | "
        +"[返回搜索页](https://mysterious-Palace.github.io/markdown/)"
      );
      document.write(
        "<iframe height=\"100%\" width=\"100%\" onload=\"changeFrameHeight(this)\" src=\""
        +articleURL
        +decodeURI(getQueryVariable("name"))+"/"
        +getQueryVariable("id")+".html\" name=\"iframe1\"></iframe>"
      );
      document.write("<br/>");
      if(Number(getQueryVariable("id"))>1)
        document.write(
          "<div style=\"display:block;float:left;\"><a href=\"?name="+getQueryVariable("name")
          +"&id="+String(Number(getQueryVariable("id"))-1)
          +"\">上一章</a></div>"
        );
      if(loadXMLDoc("../article/"+decodeURI(getQueryVariable("name"))+"/"+String(i+1)+".html"))
        document.write(
          "<div style=\"display:block;float:right;\"><a href=\"?name="+getQueryVariable("name")
          +"&id="+String(Number(getQueryVariable("id"))+1)
          +"\">下一章</a></div>"
        );
    }
  }
</script>
</html>
